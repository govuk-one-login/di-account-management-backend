"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addUserAgentMiddleware = void 0;
const version_1 = require("./version");
/**
 * @internal
 */
const EXEC_ENV = process.env.AWS_EXECUTION_ENV || 'NA';
const middlewareOptions = {
    relation: 'after',
    toMiddleware: 'getUserAgentMiddleware',
    name: 'addPowertoolsToUserAgent',
    tags: ['POWERTOOLS', 'USER_AGENT'],
};
/**
 * @internal
 * returns a middleware function for the MiddlewareStack, that can be used for the SDK clients
 * @param feature
 */
const customUserAgentMiddleware = (feature) => {
    // eslint-disable-next-line @typescript-eslint/ban-ts-comment
    // @ts-ignore
    return (next, _context) => async (args) => {
        const powertoolsUserAgent = `PT/${feature}/${version_1.PT_VERSION} PTEnv/${EXEC_ENV}`;
        args.request.headers['user-agent'] = `${args.request.headers['user-agent']} ${powertoolsUserAgent}`;
        return await next(args);
    };
};
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore
const addUserAgentMiddleware = (client, feature) => {
    try {
        if (client.middlewareStack
            .identify()
            .includes('addPowertoolsToUserAgent: POWERTOOLS,USER_AGENT')) {
            return;
        }
        client.middlewareStack.addRelativeTo(customUserAgentMiddleware(feature), middlewareOptions);
    }
    catch (e) {
        console.warn('Failed to add user agent middleware', e);
    }
};
exports.addUserAgentMiddleware = addUserAgentMiddleware;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlckFnZW50TWlkZGxld2FyZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy91c2VyQWdlbnRNaWRkbGV3YXJlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHVDQUF1QztBQUV2Qzs7R0FFRztBQUNILE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDO0FBQ3ZELE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsUUFBUSxFQUFFLE9BQU87SUFDakIsWUFBWSxFQUFFLHdCQUF3QjtJQUN0QyxJQUFJLEVBQUUsMEJBQTBCO0lBQ2hDLElBQUksRUFBRSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUM7Q0FDbkMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDSCxNQUFNLHlCQUF5QixHQUFHLENBQUMsT0FBZSxFQUFFLEVBQUU7SUFDcEQsNkRBQTZEO0lBQzdELGFBQWE7SUFDYixPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFO1FBQ3hDLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxPQUFPLElBQUksb0JBQVUsVUFBVSxRQUFRLEVBQUUsQ0FBQztRQUM1RSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDbEIsWUFBWSxDQUNiLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1FBRW5FLE9BQU8sTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUIsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsNkRBQTZEO0FBQzdELGFBQWE7QUFDYixNQUFNLHNCQUFzQixHQUFHLENBQUMsTUFBTSxFQUFFLE9BQWUsRUFBUSxFQUFFO0lBQy9ELElBQUk7UUFDRixJQUNFLE1BQU0sQ0FBQyxlQUFlO2FBQ25CLFFBQVEsRUFBRTthQUNWLFFBQVEsQ0FBQyxpREFBaUQsQ0FBQyxFQUM5RDtZQUNBLE9BQU87U0FDUjtRQUNELE1BQU0sQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUNsQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsRUFDbEMsaUJBQWlCLENBQ2xCLENBQUM7S0FDSDtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsT0FBTyxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUN4RDtBQUNILENBQUMsQ0FBQztBQUVPLHdEQUFzQiJ9